<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<link rel="stylesheet" type="text/css" href="http://jointjs.com/cms/downloads/joint.css" />
<link rel="stylesheet" type="text/css" href="geneology.css" />
<script src="http://jointjs.com/js/vendor/jquery/jquery.min.js"></script>
<script src="http://jointjs.com/js/vendor/lodash/lodash.min.js"></script>
<script src="http://jointjs.com/js/vendor/backbone/backbone-min.js"></script>
<script src="http://jointjs.com/cms/downloads/joint.min.js"></script>

<style id="css">
/* port styling */
.available-magnet {
    fill: yellow;
}

/* element styling */
.available-cell rect {
    stroke-dasharray: 5, 2;
}
</style>
</head>
<body>

	<h1>G-Tree</h1>
	
	<div id=paper></div>
	
	<script type="text/javascript">
	
	(function() {

	    var graph = new joint.dia.Graph;
	    var paper = new joint.dia.Paper({
	        el: $('#paper'),
	        width: 1650, height: 1200, gridSize: 50,
	        model: graph,
	        defaultLink: new joint.dia.Link({
	            attrs: { '.marker-target': { d: 'M 10 0 L 0 5 L 10 10 z' } }
	        }),
	        validateConnection: function(cellViewS, magnetS, cellViewT, magnetT, end, linkView) {
	            // Prevent linking from input ports.
	            if (magnetS && magnetS.getAttribute('type') === 'input') return false;
	            // Prevent linking from output ports to input ports within one element.
	            if (cellViewS === cellViewT) return false;
	            // Prevent linking to input ports.
	            return magnetT && magnetT.getAttribute('type') === 'input';
	        },
		    // Enable link snapping within 75px lookup radius
		    snapLinks: { radius: 75 },
	        // Enable marking available cells & magnets
	        markAvailable: true
	    });

	    var template = new joint.shapes.devs.Model ({
	        position: { x: 0, y: 0 },
	        size: { width: 100, height: 50 },
	        inPorts: ['',''],
	        outPorts: [''],
	        attrs: {
	            rect: { stroke: 'none'},
	            '.label': { text: 'Comment\nSecond Line Comment'},
	            '.inPorts circle': { magnet: 'passive', type: 'input', stroke: 'none', r:5},
	            '.outPorts circle': { fill: 'white', type: 'output', r:10},
	            '.inPorts': {transform: 'rotate(-90)', 'ref-x':0.25, 'ref-y': 0.99},
	            '.outPorts': {transform: 'rotate(90)', 'ref-x':75, 'ref-y': -100}
	        }
	    });

	    paper.on('cell:contextmenu ', 
	    	    function(cellView, event, x, y) {
			    	console.log('cell:contextmenu', cellView.model.id, x,y, event.pageX, event.pageY);
	    	    }
	    	);

	    paper.on('blank:contextmenu ', 
	    	    function(event, x, y) {
			    	console.log('blank:contextmenu', x, y, event.pageX, event.pageY);
	    	    }
	    	);

	    paper.on('cell:pointerdblclick ', 
	    	    function(cellView, event, x, y) {
		    		cellView.model.attr('.label/text', 'double click!')
	    	    }
	    	);

	    paper.on('blank:pointerdblclick ', 
	    	    function(event, x, y) {
			    	template.clone().translate(x-template.attributes.size.width/2, y-template.attributes.size.height/2).addTo(graph);
	    	    }
	    	);
	})()
	
	</script>
</body>
</body>
</html>