<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<link rel="stylesheet" type="text/css" href="http://jointjs.com/cms/downloads/joint.css" />
<script src="http://jointjs.com/js/vendor/jquery/jquery.min.js"></script>
<script src="http://jointjs.com/js/vendor/lodash/lodash.min.js"></script>
<script src="http://jointjs.com/js/vendor/backbone/backbone-min.js"></script>
<script src="http://jointjs.com/cms/downloads/joint.min.js"></script>
<style id="css">
/* port styling */
.available-magnet {
    fill: yellow;
}

/* element styling */
.available-cell rect {
    stroke-dasharray: 5, 2;
}
</style>
</head>
<body>

	<h1>Bottom Magnet Model</h1>
	
	<div id=paper></div>
	
	<script type="text/javascript">
	
	(function() {

	    var graph = new joint.dia.Graph;
	    var paper = new joint.dia.Paper({
	        el: $('#paper'),
	        width: 1650, height: 1200, gridSize: 50,
	        model: graph,
	        defaultLink: new joint.dia.Link({
	            attrs: { '.marker-target': { d: 'M 10 0 L 0 5 L 10 10 z' } }
	        }),
	        validateConnection: function(cellViewS, magnetS, cellViewT, magnetT, end, linkView) {
	            // Prevent linking from input ports.
	            if (magnetS && magnetS.getAttribute('type') === 'input') return false;
	            // Prevent linking from output ports to input ports within one element.
	            if (cellViewS === cellViewT) return false;
	            // Prevent linking to input ports.
	           return magnetT && magnetT.getAttribute('type') === 'input';
	        },
		    // Enable link snapping within 75px lookup radius
		    snapLinks: { radius: 75 },
	        // Enable marking available cells & magnets
	        markAvailable: true
	    });

	    joint.shapes.devs.ModelBottom = joint.shapes.basic.Generic.extend(_.extend({}, joint.shapes.basic.PortsModelInterface, {

	    	   markup: '<g class="rotatable"><g class="scalable"><rect class="body"/></g><text class="label"/><g class="inPorts"/><g class="outPorts"/></g>',
	    	   portMarkup: '<g class="port port<%= id %>"><circle class="port-body"/><text class="port-label"/></g>',

	    	   defaults: joint.util.deepSupplement({

	    	       type: 'devs.Model',
	    	       size: { width: 1, height: 1 },

	    	       inPorts: [],
	    	       outPorts: [],

	    	       attrs: {
	    	            '.': { magnet: false },
	    	           '.body': {
	    	               width: 150, height: 250,
	    	               stroke: 'black'
	    	           },
	    	           '.port-body': {
	    	               r: 10,
	    	               magnet: true,
	    	               stroke: 'black'
	    	           },
	    	           text: {
	    	               fill: 'black',
	    	               'pointer-events': 'none'
	    	           },
	    	           '.label': { text: 'Model', 'ref-x': 10, 'ref-y': .2, 'ref': '.body' },

	    	           // CHANGED: find better positions for port labels 
	    	           '.inPorts .port-label': { dy:-30, x: 4 },
	    	           '.outPorts .port-label':{ dy: 15, x: 4 }
	    	           //
	    	       }

	    	   }, joint.shapes.basic.Generic.prototype.defaults),

	    	   getPortAttrs: function(portName, index, total, selector, type) {

	    	       var attrs = {};

	    	       var portClass = 'port' + index;
	    	       var portSelector = selector + '>.' + portClass;
	    	       var portLabelSelector = portSelector + '>.port-label';
	    	       var portBodySelector = portSelector + '>.port-body';

	    	       attrs[portLabelSelector] = { text: portName };
	    	       attrs[portBodySelector] = { port: { id: portName || _.uniqueId(type) , type: type } };

	    	       // CHANGED: swap x and y ports coordinates ('ref-y' => 'ref-x')
	    	       attrs[portSelector] = { ref: '.body', 'ref-x': (index + 0.5) * (1 / total) };
	    	       // ('ref-dx' => 'ref-dy')
	    	       if (selector === '.outPorts') { attrs[portSelector]['ref-dy'] = 0; }
	    	       //

	    	       return attrs;
	    	   }
	    	}));
	    
	    var m1 = new joint.shapes.devs.ModelBottom({
	        position: { x: 50, y: 50 },
	        size: { width: 90, height: 90 },
	        inPorts: ['in1','in2'],
	        outPorts: ['out'],
	        attrs: {
	            '.label': { text: 'Model', 'ref-x': .4, 'ref-y': .2 },
	            rect: { fill: '#2ECC71' },
	            '.inPorts circle': { fill: '#16A085', magnet: 'passive', type: 'input' },
	            '.outPorts circle': { fill: '#E74C3C', type: 'output' }
	        },
	        
	    }).addTo(graph);

	    var m2 = m1.clone().translate(300, 0).attr('.label/text', 'Model 2').addTo(graph);

	})()
	
	</script>
</body>
</body>
</html>