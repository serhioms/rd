<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<!-- $Id: ctr-cm-eod-csm-wf.xml 4168 2016-06-23 19:16:47Z gmusial $
	 Maestro version: 1.16.0 -->
	
<workflow xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:noNamespaceSchemaLocation="workflowDefinition.xsd">
	<name>ctr-cm-eod-csm-wf</name> 
  	<externalWorkflowCode>ctr-cm-eod-csm-wf</externalWorkflowCode> 
  	<finishOrchestrationASAPOnError>false</finishOrchestrationASAPOnError> 
	<description>ctr-cm-eod-csm-wf ($LastChangedRevision: 4168 $)</description>
	
	<properties>
		<inputProperties>
			<property name="WF-EOD-EOM-INDICATOR">D</property>
			<property name="RUN-INSTANCE">1</property>
		</inputProperties>
		<generalProperties>
			<property name="ROOT-WF-ID">ctr-cm-eod-csm-wf</property>
			<property name="WORKFLOW_RUN_ID">0</property>
			<!-- Source Directories -->
			<property name="FTP-SOURCE-DIR">csm/inbox</property>
			<property name="HOLDING-DIR">${CTR_DATA_ROOT_PATH}/manual/csm</property>
			<property name="HOLDING-MATCH-PATTERN">.+_${WF-EOD-EOM-INDICATOR}_${INITIALIZE-RUN.BUSINESS-DATE-FORMATTED}_.+</property>
			<property name="SQLLDR-PROCESSING-SOURCE-DIR">data_in/infiles</property>
			<property name="SQLLDR-CONTROL-DIRECTORY">sqlldr</property>
			<property name="SQLLDR-DISCARD-DIR">data_in/discard</property>
			<property name="SQLLDR-REJECT-DIRECTORY">data_in/reject</property>
			<property name="SQLLDR-LOG-DIRECTORY">data_in/ldrlog</property>
			
			<property name="REPLICATE-SRC-IF-MONTH-END">F</property>
			<property name="DATA-CATEGORY-TYPE">CM</property>
			
			<!-- Source file naming pattern -->
			<property name="SRC-FILE-PRODUCTTYPE-PATTERN">[^_]*[_]?</property>
			<property name="SRC-FILE-FILETYPE-PATTERN">[PT]?[_]?</property>
			<property name="SRC-FILE-FREQUENCY-PATTERN">${WF-EOD-EOM-INDICATOR}_</property>
			<property name="SRC-FILE-VERSION-PATTERN-REMOTE">(${INITIALIZE-RUN.BUSINESS-DATE-FORMATTED})?_(${INITIALIZE-RUN.P_RUN_ID_O})?</property>
			<property name="SRC-FILE-VERSION-PATTERN-MANUAL">(${INITIALIZE-RUN.BUSINESS-DATE-FORMATTED})?_[0-9]+</property>
			<property name="SRC-FILE-SUFFIX-PATTERN-MANUAL">${SRC-FILE-PRODUCTTYPE-PATTERN}${SRC-FILE-FILETYPE-PATTERN}${SRC-FILE-FREQUENCY-PATTERN}${SRC-FILE-VERSION-PATTERN-MANUAL}</property>
			<property name="SRC-FILE-SUFFIX-PATTERN-REMOTE">${SRC-FILE-PRODUCTTYPE-PATTERN}${SRC-FILE-FILETYPE-PATTERN}${SRC-FILE-FREQUENCY-PATTERN}${SRC-FILE-VERSION-PATTERN-REMOTE}</property>
			
		</generalProperties>
	</properties>	

	<sequential name="CTR-CAPITAL-MARKETS" id="CTR-CAPITAL-MARKETS">
	
		<externalWorkflowReference name="INITIALIZE-RUN" id="INITIALIZE-RUN">
			<externalWorkflowCode>INITIALIZE-RUN</externalWorkflowCode>
			<inputProperties>
				<property name="EOD-EOM-INDICATOR">${WF-EOD-EOM-INDICATOR}</property>
				<property name="SOURCE-SYSTEM">CSM</property>
				<property name="ROOT-WF-ID">${ROOT-WF-ID}</property>
				<property name="TARGET-SYSTEM"></property>
				<property name="RUN-TYPE" />
				<property name="RUN-INSTANCE">${RUN-INSTANCE}</property>
				<property name="WORKFLOW-RUN-ID">${WORKFLOW_RUN_ID}</property>
			</inputProperties>
			<outputPropertyMapping>
				<mapping source="BUSINESS-DATE" target="BUSINESS-DATE"/>
				<mapping source="BUSINESS-DATE-FORMATTED" target="BUSINESS-DATE-FORMATTED"/>
				<mapping source="RUN-ID" target="P_RUN_ID_O"/>
				<mapping source="IS-MONTH-END" target="IS-MONTH-END"/>
			</outputPropertyMapping>
		</externalWorkflowReference>
		
		<!-- BEGIN : CSM  -->
			<externalWorkflowReference name="CM-CSM-WF" id="CM-CSM-WF">
				<externalWorkflowCode>CM-CSM-WF</externalWorkflowCode>
				<inputProperties>
					<property name="WF-EOD-EOM-INDICATOR">D</property>
					<property name="SOURCE-SYSTEM">CSM</property>
					<property name="RUN-ID" >${INITIALIZE-RUN.P_RUN_ID_O}</property>
					<property name="BUSINESS-DATE">${INITIALIZE-RUN.BUSINESS-DATE}</property>
					<property name="BUSINESS-DATE-FORMATTED">${INITIALIZE-RUN.BUSINESS-DATE-FORMATTED}</property>
					<property name="IS-MONTH-END">${INITIALIZE-RUN.IS-MONTH-END}</property>
				</inputProperties>
			</externalWorkflowReference>
		<!-- END : CSM  -->
		
		<externalWorkflowReference name="FINALIZE-RUN" id="COMPLETE-RUN">
			<description>Finalize the run and mark complete</description>
			<externalWorkflowCode>FINALIZE-RUN</externalWorkflowCode>
			<inputProperties>
				<property name="SOURCE-SYSTEM">NONE</property>
				<property name="RUN-ID">${INITIALIZE-RUN.P_RUN_ID_O}</property>
				<property name="BUSINESS-DATE">${INITIALIZE-RUN.BUSINESS-DATE}</property>
				<property name="SRC-FILE-SUFFIX-PATTERN">NONE</property>
				<property name="FTP-SOURCE-DIR">${CTR_FTP_ROOT_PATH}/${FTP-SOURCE-DIR}</property>
			</inputProperties>
		</externalWorkflowReference>
	</sequential>
</workflow>