<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<!-- $Id: ctr-transfer-files-to-downstream-eod-wf.xml 4284 2016-06-30 13:11:55Z sroman1 $
	 Maestro version: 1.19.5 -->
	
<workflow xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:noNamespaceSchemaLocation="workflowDefinition.xsd">
	<name>ctr-transfer-files-to-downstream-wf</name> 
  	<externalWorkflowCode>ctr-transfer-files-to-downstream-wf</externalWorkflowCode> 
  	<finishOrchestrationASAPOnError>false</finishOrchestrationASAPOnError> 
	<description>ctr-transfer-files-to-downstream-wf ($LastChangedRevision: 4284 $)</description>
	
	<properties>
		<inputProperties>
			<property name="WF-EOD-EOM-INDICATOR">D</property>
			<property name="RUN-INSTANCE">1</property>
		</inputProperties>
		<generalProperties>
			<property name="ROOT-WF-ID">ctr-transfer-files-to-downstream-wf</property>
			<property name="WORKFLOW_RUN_ID">0</property>
			<!-- Source Directories -->
			<property name="SYNCOVA-FTP-SOURCE-DIR">syncova/inbox</property>
			<property name="ACBS-FTP-SOURCE-DIR">acbs/inbox</property>
			<property name="SILOPICS-FTP-SOURCE-DIR">silopics/inbox</property>
			<property name="SQLLDR-PROCESSING-SOURCE-DIR">data_in/infiles</property>
			<property name="ANVILLON-FTP-SOURCE-DIR">anvillon/inbox</property>
			<property name="SRC-FILE-SUFFIX-PATTERN-1">${INITIALIZE-RUN.BUSINESS-DATE-FORMATTED}</property>
		</generalProperties>
	</properties>	
	
	<sequential name="CTR-TO-DOWNSTREAM" id="CTR-TO-DOWNSTREAM">
	
		<externalWorkflowReference name="INITIALIZE-RUN" id="INITIALIZE-RUN">
			<externalWorkflowCode>INITIALIZE-RUN</externalWorkflowCode>
			<inputProperties>
				<property name="EOD-EOM-INDICATOR">${WF-EOD-EOM-INDICATOR}</property>
				<property name="SOURCE-SYSTEM">-1</property>
				<property name="ROOT-WF-ID">${ROOT-WF-ID}</property>
				<property name="TARGET-SYSTEM"></property>
				<property name="RUN-TYPE" />
				<property name="RUN-INSTANCE">${RUN-INSTANCE}</property>
				<property name="WORKFLOW-RUN-ID">${WORKFLOW_RUN_ID}</property>
			</inputProperties>
			<outputPropertyMapping>
				<mapping source="BUSINESS-DATE" target="BUSINESS-DATE"/>
				<mapping source="BUSINESS-DATE-FORMATTED" target="BUSINESS-DATE-FORMATTED"/>
				<mapping source="RUN-ID" target="P_RUN_ID_O"/>
				<mapping source="IS-MONTH-END" target="IS-MONTH-END"/>
			</outputPropertyMapping>
		</externalWorkflowReference>
		
		<stage id="SET-SRC-FILE-SUB-DIRECTORY-NONPRD" name="SET-SRC-FILE-SUB-DIRECTORY-NONPRD">
            <description>Set the sub directory path for non PROD runs</description>
			<skipCondition>'${MAESTRO_RUN_ENV}' == 'PROD'</skipCondition>
            <execDefinition>
                <noOpExecDefinition>
                    <input>/inbox</input>
                    <numberOfTasks>1</numberOfTasks>
                    <numberOfInterimStatusResponses>1</numberOfInterimStatusResponses>
                    <durationBetweenEventsInMs>250</durationBetweenEventsInMs>
                    <outputPropertyName>#SRC-FILE-SUB-DIRECTORY</outputPropertyName>
                </noOpExecDefinition>
            </execDefinition>
        </stage>
         <stage id="SET-SRC-FILE-SUB-DIRECTORY-PRD" name="SET-SRC-FILE-SUB-DIRECTORY-PRD">
            <description>Set the sub directory path for PROD runs</description>
			<skipCondition>'${MAESTRO_RUN_ENV}' != 'PROD'</skipCondition>
            <execDefinition>
                <noOpExecDefinition>
                    <input>/${INITIALIZE-RUN.BUSINESS-DATE-FORMATTED}</input>
                    <numberOfTasks>1</numberOfTasks>
                    <numberOfInterimStatusResponses>1</numberOfInterimStatusResponses>
                    <durationBetweenEventsInMs>250</durationBetweenEventsInMs>
                    <outputPropertyName>#SRC-FILE-SUB-DIRECTORY</outputPropertyName>
                </noOpExecDefinition>
            </execDefinition>
        </stage>
		
		<parallel id="TRANSFER-FILEWATCH-WORKFLOWS" name="TRANSFER-FILEWATCH-WORKFLOWS">
			<sequential id="ACBS-FILE-TRANSFER" name="ACBS-FILE-TRANSFER">	
				<stage name="FILEWATCH-ACBS" id="FILEWATCH-ACBS">
					<autoRetryConfiguration>
						<delayBetweenAttemptsInMs>60000</delayBetweenAttemptsInMs>
						<maximumNumberOfRetryAttempts>1080</maximumNumberOfRetryAttempts>
						<maximumRetryDurationInMs>64800000</maximumRetryDurationInMs>
					</autoRetryConfiguration>
					<execDefinition>
						<pollingFileWatcher>
							<watchedFiles>
								<resource>
									<uri>${CTR_FTP_ROOT_PATH}/${ACBS-FTP-SOURCE-DIR}</uri>
									<searchPattern>ACBS-FE-${INITIALIZE-RUN.BUSINESS-DATE-FORMATTED}.(TXT|txt)</searchPattern>
									<matchedUriOutputProperty>FE-FILE-TXT</matchedUriOutputProperty>
								</resource>
								<resource>
									<uri>${CTR_FTP_ROOT_PATH}/${ACBS-FTP-SOURCE-DIR}</uri>
									<searchPattern>ACBS-FE-${INITIALIZE-RUN.BUSINESS-DATE-FORMATTED}.TXT.mrk</searchPattern>
									<matchedUriOutputProperty>FE-FILE-MRK</matchedUriOutputProperty>
								</resource>
							</watchedFiles>
							<matchedCountProperty>matchedCount</matchedCountProperty>
						</pollingFileWatcher>
					</execDefinition>
				</stage>
				<parallel id="CHECKSUM-ACBS" name="CHECKSUM">
					<stage name="CHECKSUM-ACBS-FE-FILE" id="CHECKSUM-ACBS-FE-FILE">
						<description>Validate checksum for file PA-Entity</description>
						<execDefinition>
							<checksumValidation>
								<sourceResource>
									<uri>${FILEWATCH-ACBS.FE-FILE-TXT}</uri>
								</sourceResource>
								<markerResource>
									<uri>${FILEWATCH-ACBS.FE-FILE-MRK}</uri>
								</markerResource>
								<checksumAlgorithm>SHA256</checksumAlgorithm>
							</checksumValidation>
						</execDefinition>
					</stage>
				</parallel>
				<parallel id="TRANSFER-FILES-ACBS" name="TRANSFER-FILES">
					<externalWorkflowReference name="TRANSFER-DATA-FILES-TO-VOLCKER" id="TRANSFER-DATA-FILES-ACBS">
						<externalWorkflowCode>EXPORT-SRC-FILES-WF</externalWorkflowCode>
						<inputProperties>
							<property name="SOURCE-SYSTEM">ACBS</property>
							<property name="SOURCE-SYSTEM-LC">acbs</property>
							<property name="DEST_URI">${VOLCKER_DESTINATION_URI}</property>
							<property name="SRC_URI">${CTR_FTP_ROOT_PATH}/${ACBS-FTP-SOURCE-DIR}</property>
							<property name="SRCH_PATTERN">ACBS-FE-.*${INITIALIZE-RUN.BUSINESS-DATE-FORMATTED}.(TXT|txt|TXT.mrk)</property>
							<property name="DEST_SYSTEM">VOLCKER</property>
						</inputProperties>
					</externalWorkflowReference>
				</parallel>
				
				<externalWorkflowReference name="LOG-ACBS-FILES" id="LOG-ACBS-FILES">
						<skipCondition>${FILEWATCH-ACBS.matchedCount} == 0</skipCondition>
						<externalWorkflowCode>LOG-FILE</externalWorkflowCode>
						<inputProperties>
							<property name="RUN-ID">${INITIALIZE-RUN.P_RUN_ID_O}</property>
							<property name="BUSINESS-DATE">${INITIALIZE-RUN.BUSINESS-DATE}</property>
							<property name="SOURCE-SYSTEM">ACBS</property>
							<property name="SOURCE-FILE">${FILEWATCH-ACBS.FE-FILE-TXT}</property>
							<property name="PROCESSING-SOURCE-PATH">${CTR_FTP_ROOT_PATH}/${ACBS-FTP-SOURCE-DIR}</property>
							<property name="FTP-SOURCE-DIR">${CTR_FTP_ROOT_PATH}/${ACBS-FTP-SOURCE-DIR}</property>
							<property name="PROCESSING-DIR">${CTR_DATA_INBOUND_PATH}</property>
							<property name="DELIMITER">,</property>
						</inputProperties>
				</externalWorkflowReference>
				
				<stage name="CLEAN-UP-FTP-DIR-ACBS" id="CLEAN-UP-FTP-DIR-ACBS">
					<description>Clean up files in FTP directory</description>
					<skipCondition>${FILEWATCH-ACBS.matchedCount} == 0</skipCondition>
					<execDefinition>
						<deleteResource failOnError="false">
							<resource>
								<uri>${FILEWATCH-ACBS.FE-FILE-TXT}</uri>
							</resource>
							<resource>
								<uri>${FILEWATCH-ACBS.FE-FILE-MRK}</uri>
							</resource>			
							<deleteCountProperty>matchedCount</deleteCountProperty>
						</deleteResource>
					</execDefinition>
				</stage>			
			</sequential>
			
			<sequential id="SILOPICS-FILE-TRANSFER" name="SILOPICS-FILE-TRANSFER">	
				<stage name="FILEWATCH-SILOPICS" id="FILEWATCH-SILOPICS">
					<autoRetryConfiguration>
						<delayBetweenAttemptsInMs>60000</delayBetweenAttemptsInMs>
						<maximumNumberOfRetryAttempts>1080</maximumNumberOfRetryAttempts>
						<maximumRetryDurationInMs>64800000</maximumRetryDurationInMs>
					</autoRetryConfiguration>
					<execDefinition>
						<pollingFileWatcher>
							<watchedFiles>
								<resource>
									<uri>${CTR_FTP_ROOT_PATH}/${SILOPICS-FTP-SOURCE-DIR}</uri>
									<searchPattern>SILOPICS_FE_DL_D_${INITIALIZE-RUN.BUSINESS-DATE-FORMATTED}_[0-9]{1,2}.csv</searchPattern>
									<matchedUriOutputProperty>FE-DL-FILE</matchedUriOutputProperty>
								</resource>
								<resource>
									<uri>${CTR_FTP_ROOT_PATH}/${SILOPICS-FTP-SOURCE-DIR}</uri>
									<searchPattern>SILOPICS_FE_DL_D_${INITIALIZE-RUN.BUSINESS-DATE-FORMATTED}_[0-9]{1,2}.mrk</searchPattern>
									<matchedUriOutputProperty>FE-DL-MRK</matchedUriOutputProperty>
								</resource>
							</watchedFiles>
							<matchedCountProperty>matchedCount</matchedCountProperty>
						</pollingFileWatcher>
					</execDefinition>
				</stage>
				<parallel id="CHECKSUM-SILOPICS" name="CHECKSUM">
					<stage name="CHECKSUM-SILOPICS-FE-FILE" id="CHECKSUM-SILOPICS-FE-FILE">
						<description>Validate checksum for file FE-FILE</description>
						<execDefinition>
							<checksumValidation>
								<sourceResource>
									<uri>${FILEWATCH-SILOPICS.FE-DL-FILE}</uri>
								</sourceResource>
								<markerResource>
									<uri>${FILEWATCH-SILOPICS.FE-DL-MRK}</uri>
								</markerResource>
								<checksumAlgorithm>SHA256</checksumAlgorithm>
							</checksumValidation>
						</execDefinition>
					</stage>
				</parallel>
				<parallel id="TRANSFER-FILES-SILOPICS" name="TRANSFER-FILES">
					<externalWorkflowReference name="TRANSFER-DATA-FILES-TO-VOLCKER" id="TRANSFER-DATA-FILES-SILOPICS">
						<externalWorkflowCode>EXPORT-SRC-FILES-WF</externalWorkflowCode>
						<inputProperties>
							<property name="SOURCE-SYSTEM">SILOPICS</property>
							<property name="SOURCE-SYSTEM-LC">silopics</property>
							<property name="DEST_URI">${VOLCKER_DESTINATION_URI}</property>
							<property name="SRC_URI">${CTR_FTP_ROOT_PATH}/${SILOPICS-FTP-SOURCE-DIR}</property>
							<property name="SRCH_PATTERN">SILOPICS_FE_DL_D_${INITIALIZE-RUN.BUSINESS-DATE-FORMATTED}_[0-9]{1,2}.(csv|mrk)</property>
							<property name="DEST_SYSTEM">VOLCKER</property>
						</inputProperties>
					</externalWorkflowReference>
				</parallel>
				
				<externalWorkflowReference name="LOG-SILOPICS-FILES" id="LOG-SILOPICS-FILES">
					<skipCondition>${FILEWATCH-SILOPICS.matchedCount} == 0</skipCondition>
						<externalWorkflowCode>LOG-FILE</externalWorkflowCode>
						<inputProperties>
							<property name="RUN-ID">${INITIALIZE-RUN.P_RUN_ID_O}</property>
							<property name="BUSINESS-DATE">${INITIALIZE-RUN.BUSINESS-DATE}</property>
							<property name="SOURCE-SYSTEM">SILOPICS</property>
							<property name="SOURCE-FILE">${FILEWATCH-SILOPICS.FE-DL-FILE}</property>
							<property name="PROCESSING-SOURCE-PATH">${CTR_FTP_ROOT_PATH}/${SILOPICS-FTP-SOURCE-DIR}</property>
							<property name="FTP-SOURCE-DIR">${CTR_FTP_ROOT_PATH}/${SILOPICS-FTP-SOURCE-DIR}</property>
							<property name="PROCESSING-DIR">${CTR_DATA_INBOUND_PATH}</property>
							<property name="DELIMITER">,</property>
						</inputProperties>
				</externalWorkflowReference>
					
				<stage name="CLEAN-UP-FTP-DIR-SILOPICS" id="CLEAN-UP-FTP-DIR-SILOPICS">
					<description>Clean up files in FTP directory</description>
					<skipCondition>${FILEWATCH-SILOPICS.matchedCount} == 0</skipCondition>
					<execDefinition>
						<deleteResource failOnError="false">
							<resource>
								<uri>${FILEWATCH-SILOPICS.FE-DL-FILE}</uri>
							</resource>
							<resource>
								<uri>${FILEWATCH-SILOPICS.FE-DL-MRK}</uri>
							</resource>			
							<deleteCountProperty>matchedCount</deleteCountProperty>
						</deleteResource>
					</execDefinition>
				</stage>
			</sequential>
			
			<sequential id="SYNCOVA-FILE-TRANSFER" name="SYNCOVA-FILE-TRANSFER">	
				<stage name="FILEWATCH-SYNCOVA" id="FILEWATCH-SYNCOVA">
					<autoRetryConfiguration>
						<delayBetweenAttemptsInMs>60000</delayBetweenAttemptsInMs>
						<maximumNumberOfRetryAttempts>1080</maximumNumberOfRetryAttempts>
						<maximumRetryDurationInMs>64800000</maximumRetryDurationInMs>
					</autoRetryConfiguration>
					<execDefinition>
						<pollingFileWatcher>
							<watchedFiles>
								<resource>
									<uri>${CTR_FTP_ROOT_PATH}/${SYNCOVA-FTP-SOURCE-DIR}</uri>
									<searchPattern>Report_margin_lock_${INITIALIZE-RUN.BUSINESS-DATE-FORMATTED}.csv</searchPattern>
									<matchedUriOutputProperty>REP-MARGIN-LOCK-CSV</matchedUriOutputProperty>
								</resource>
								<resource>
									<uri>${CTR_FTP_ROOT_PATH}/${SYNCOVA-FTP-SOURCE-DIR}</uri>
									<searchPattern>Report_margin_lock_${INITIALIZE-RUN.BUSINESS-DATE-FORMATTED}.mrk</searchPattern>
									<matchedUriOutputProperty>REP-MARGIN-LOCK-MRK</matchedUriOutputProperty>
								</resource>
								<resource>
									<uri>${CTR_FTP_ROOT_PATH}/${SYNCOVA-FTP-SOURCE-DIR}</uri>
									<searchPattern>Report_margin_lock_Mapping_Table_${INITIALIZE-RUN.BUSINESS-DATE-FORMATTED}.csv</searchPattern>
									<matchedUriOutputProperty>REP-MARGIN-LOCK-MAP-CSV</matchedUriOutputProperty>
								</resource>
								<resource>
									<uri>${CTR_FTP_ROOT_PATH}/${SYNCOVA-FTP-SOURCE-DIR}</uri>
									<searchPattern>Report_margin_lock_Mapping_Table_${INITIALIZE-RUN.BUSINESS-DATE-FORMATTED}.mrk</searchPattern>
									<matchedUriOutputProperty>REP-MARGIN-LOCK-MAP-MRK</matchedUriOutputProperty>
								</resource>
							</watchedFiles>
							<matchedCountProperty>matchedCount</matchedCountProperty>
						</pollingFileWatcher>
					</execDefinition>
				</stage>
				<parallel id="CHECKSUM-SYNCOVA" name="CHECKSUM">
					<stage name="CHECKSUM-SYNCOVA-REP-MARGIN-LOCK" id="CHECKSUM-SYNCOVA-REP-MARGIN-LOCK">
						<description>Validate checksum for file PA-Entity</description>
						<execDefinition>
							<checksumValidation>
								<sourceResource>
									<uri>${FILEWATCH-SYNCOVA.REP-MARGIN-LOCK-CSV}</uri>
								</sourceResource>
								<markerResource>
									<uri>${FILEWATCH-SYNCOVA.REP-MARGIN-LOCK-MRK}</uri>
								</markerResource>
								<checksumAlgorithm>SHA256</checksumAlgorithm>
							</checksumValidation>
						</execDefinition>
					</stage>
					<stage name="CHECKSUM-SYNCOVA-REP-MARGIN-LOCK-MAP" id="CHECKSUM-SYNCOVA-REP-MARGIN-LOCK-MAP">
						<description>Validate checksum for file PA-Entity</description>
						<execDefinition>
							<checksumValidation>
								<sourceResource>
									<uri>${FILEWATCH-SYNCOVA.REP-MARGIN-LOCK-MAP-CSV}</uri>
								</sourceResource>
								<markerResource>
									<uri>${FILEWATCH-SYNCOVA.REP-MARGIN-LOCK-MAP-MRK}</uri>
								</markerResource>
								<checksumAlgorithm>SHA256</checksumAlgorithm>
							</checksumValidation>
						</execDefinition>
					</stage>
				</parallel>
				<parallel id="TRANSFER-FILES-LRDC" name="TRANSFER-FILES">
					<externalWorkflowReference name="TRANSFER-DATA-FILES-TO-LRDC" id="TRANSFER-DATA-FILES-SYNCOVA">
						<externalWorkflowCode>EXPORT-SRC-FILES-WF</externalWorkflowCode>
						<inputProperties>
							<property name="SOURCE-SYSTEM">SYNCOVA</property>
							<property name="SOURCE-SYSTEM-LC">syncova</property>
							<property name="DEST_URI">${LRDC_DESTINATION_URI}</property>
							<property name="SRC_URI">${CTR_FTP_ROOT_PATH}/${SYNCOVA-FTP-SOURCE-DIR}</property>
							<property name="SRCH_PATTERN">Report_margin_lock_.*${INITIALIZE-RUN.BUSINESS-DATE-FORMATTED}.*</property>
							<property name="DEST_SYSTEM">LRDC</property>
						</inputProperties>
					</externalWorkflowReference>
				</parallel>
				
				<parallel id="LOG-SYNCOVA-FILES" name="LOG-SYNCOVA-FILES" >
					<skipCondition>${FILEWATCH-SYNCOVA.matchedCount} == 0</skipCondition>
					<externalWorkflowReference name="LOG-SYNCOVA-REP-MARGIN-FILES" id="LOG-SYNCOVA-REP-MARGIN-FILES">
						<externalWorkflowCode>LOG-FILE</externalWorkflowCode>
						<inputProperties>
							<property name="RUN-ID">${INITIALIZE-RUN.P_RUN_ID_O}</property>
							<property name="BUSINESS-DATE">${INITIALIZE-RUN.BUSINESS-DATE}</property>
							<property name="SOURCE-SYSTEM">SYNCOVA</property>
							<property name="SOURCE-FILE">${FILEWATCH-SYNCOVA.REP-MARGIN-LOCK-CSV}</property>
							<property name="PROCESSING-SOURCE-PATH">${CTR_FTP_ROOT_PATH}/${SYNCOVA-FTP-SOURCE-DIR}</property>
							<property name="FTP-SOURCE-DIR">${CTR_FTP_ROOT_PATH}/${SYNCOVA-FTP-SOURCE-DIR}</property>
							<property name="PROCESSING-DIR">${CTR_DATA_INBOUND_PATH}</property>
							<property name="DELIMITER">,</property>
						</inputProperties>
					</externalWorkflowReference>
					<externalWorkflowReference name="LOG-SYNCOVA-REP-MARGIN-MAP-FILES" id="LOG-SYNCOVA-REP-MARGIN-MAP-FILES">
						<externalWorkflowCode>LOG-FILE</externalWorkflowCode>
						<inputProperties>
							<property name="RUN-ID">${INITIALIZE-RUN.P_RUN_ID_O}</property>
							<property name="BUSINESS-DATE">${INITIALIZE-RUN.BUSINESS-DATE}</property>
							<property name="SOURCE-SYSTEM">SYNCOVA</property>
							<property name="SOURCE-FILE">${FILEWATCH-SYNCOVA.REP-MARGIN-LOCK-MAP-CSV}</property>
							<property name="PROCESSING-SOURCE-PATH">${CTR_FTP_ROOT_PATH}/${SYNCOVA-FTP-SOURCE-DIR}</property>
							<property name="FTP-SOURCE-DIR">${CTR_FTP_ROOT_PATH}/${SYNCOVA-FTP-SOURCE-DIR}</property>
							<property name="PROCESSING-DIR">${CTR_DATA_INBOUND_PATH}</property>
							<property name="DELIMITER">,</property>
						</inputProperties>
					</externalWorkflowReference>
				</parallel>
				
				<stage name="CLEAN-UP-FTP-DIR-SYNCOVA" id="CLEAN-UP-FTP-DIR-SYNCOVA">
					<description>Clean up files in FTP directory</description>
					<skipCondition>${FILEWATCH-SYNCOVA.matchedCount} == 0</skipCondition>
					<execDefinition>
						<deleteResource failOnError="false">
							<resource>
								<uri>${FILEWATCH-SYNCOVA.REP-MARGIN-LOCK-CSV}</uri>
							</resource>
							<resource>
								<uri>${FILEWATCH-SYNCOVA.REP-MARGIN-LOCK-MRK}</uri>
							</resource>		
							<resource>
								<uri>${FILEWATCH-SYNCOVA.REP-MARGIN-LOCK-MAP-CSV}</uri>
							</resource>		
							<resource>
								<uri>${FILEWATCH-SYNCOVA.REP-MARGIN-LOCK-MAP-MRK}</uri>
							</resource>							
							<deleteCountProperty>matchedCount</deleteCountProperty>
						</deleteResource>
					</execDefinition>
				</stage>
			</sequential>
				
			<!--  -->
			
			<sequential id="ANVIL-EXTRACT-FILE-TRANSFER" name="ANVILEXTRACT-FILE-TRANSFER">	
				<skipCondition>'${ANVILLON_REMOTE_SOURCE_URI}' == 'NONE'</skipCondition>
				<stage name="FILEWATCH-ANVILLON" id="FILEWATCH-ANVILLON">
					<autoRetryConfiguration>
						<delayBetweenAttemptsInMs>60000</delayBetweenAttemptsInMs>
						<maximumNumberOfRetryAttempts>1080</maximumNumberOfRetryAttempts>
						<maximumRetryDurationInMs>64800000</maximumRetryDurationInMs>
					</autoRetryConfiguration>
					<execDefinition>
						<pollingFileWatcher>
                            <watchedFiles>
                                <resource>
                                    <uri>${ANVILLON_REMOTE_SOURCE_URI}${#SRC-FILE-SUB-DIRECTORY}</uri>
                                    <searchPattern>lon_anvil_book_${SRC-FILE-SUFFIX-PATTERN-1}.csv</searchPattern>
                                    <matchedUriOutputProperty>lon-anvil-book</matchedUriOutputProperty>
                                </resource>
                                <resource>
                                    <uri>${ANVILLON_REMOTE_SOURCE_URI}${#SRC-FILE-SUB-DIRECTORY}</uri>
                                    <searchPattern>lon_anvil_book_code_key_${SRC-FILE-SUFFIX-PATTERN-1}.csv</searchPattern>
                                    <matchedUriOutputProperty>lon-anvil-book-code-key</matchedUriOutputProperty>
                                </resource>
                                <resource>
                                    <uri>${ANVILLON_REMOTE_SOURCE_URI}${#SRC-FILE-SUB-DIRECTORY}</uri>
                                    <searchPattern>lon_anvil_counterparty_${SRC-FILE-SUFFIX-PATTERN-1}.csv</searchPattern>
                                    <matchedUriOutputProperty>lon-anvil-counterparty</matchedUriOutputProperty>
                                </resource>
                                <resource>
                                    <uri>${ANVILLON_REMOTE_SOURCE_URI}${#SRC-FILE-SUB-DIRECTORY}</uri>
                                    <searchPattern>lon_anvil_cpty_code_key_${SRC-FILE-SUFFIX-PATTERN-1}.csv</searchPattern>
                                    <matchedUriOutputProperty>lon-anvil-cpty-code-key</matchedUriOutputProperty>
                                </resource>
                                <resource>
                                    <uri>${ANVILLON_REMOTE_SOURCE_URI}${#SRC-FILE-SUB-DIRECTORY}</uri>
                                    <searchPattern>lon_anvil_exposure_${SRC-FILE-SUFFIX-PATTERN-1}.csv</searchPattern>
                                    <matchedUriOutputProperty>lon-anvil-exposure</matchedUriOutputProperty>
                                </resource>
                                <resource>
                                    <uri>${ANVILLON_REMOTE_SOURCE_URI}${#SRC-FILE-SUB-DIRECTORY}</uri>
                                    <searchPattern>lon_anvil_security_code_key_${SRC-FILE-SUFFIX-PATTERN-1}.csv</searchPattern>
                                    <matchedUriOutputProperty>lon-anvil-security-code-key</matchedUriOutputProperty>
                                </resource>
                                <resource>
                                    <uri>${ANVILLON_REMOTE_SOURCE_URI}${#SRC-FILE-SUB-DIRECTORY}</uri>
                                    <searchPattern>lon_anvil_instrument_${SRC-FILE-SUFFIX-PATTERN-1}.csv</searchPattern>
                                    <matchedUriOutputProperty>lon-anvil-instrument</matchedUriOutputProperty>
                                </resource>
                                <resource>
                                    <uri>${ANVILLON_REMOTE_SOURCE_URI}${#SRC-FILE-SUB-DIRECTORY}</uri>
                                    <searchPattern>lon_anvil_trade_${SRC-FILE-SUFFIX-PATTERN-1}.csv</searchPattern>
                                    <matchedUriOutputProperty>lon-anvil-trade</matchedUriOutputProperty>
                                </resource>
                            </watchedFiles>
                            <matchedCountProperty>matchedCount</matchedCountProperty>
                            <allowFileNotFound>false</allowFileNotFound>
                        </pollingFileWatcher>
					</execDefinition>
				</stage>
				
				<parallel id="GENERATE-MRK-ANVIL-EXTRACTS" name="GENERATE-MRK-ANVIL-EXTRACTS">
					<skipCondition>'${SAG_DESTINATION_URI}' == 'NONE'</skipCondition>
					<stage name="GENERATE-MRK-LON-ANVIL-BOOK" id="GENERATE-MRK-LON-ANVIL-BOOK">
						<description>Validate checksum for file AccountMapping</description>
						<execDefinition>
							<checksumGeneration>
								<sourceResource>
									<uri>${FILEWATCH-ANVILLON.lon-anvil-book}</uri>
								</sourceResource>
								<markerResource>
									<uri>${SAG_DESTINATION_URI}/lon_anvil_book_${SRC-FILE-SUFFIX-PATTERN-1}.mrk</uri>
								</markerResource>
								<checksumAlgorithm>SHA256</checksumAlgorithm>
							</checksumGeneration>
						</execDefinition>
					</stage>
					<stage name="GENERATE-MRK-LON-ANVIL-BOOK-CODE-KEY" id="GENERATE-MRK-LON-ANVIL-BOOK-CODE-KEY">
						<description>Validate checksum for file TransitMapping</description>
						<execDefinition>
							<checksumGeneration>
								<sourceResource>
									<uri>${FILEWATCH-ANVILLON.lon-anvil-book-code-key}</uri>
								</sourceResource>
								<markerResource>
									<uri>${SAG_DESTINATION_URI}/lon_anvil_book_code_key_${SRC-FILE-SUFFIX-PATTERN-1}.mrk</uri>
								</markerResource>
								<checksumAlgorithm>SHA256</checksumAlgorithm>
							</checksumGeneration>
						</execDefinition>
					</stage>
					<stage name="GENERATE-MRK-LON-ANVIL-COUNTERPARTY" id="GENERATE-MRK-LON-ANVIL-COUNTERPARTY">
						<description>Validate checksum for file EGLDepartment</description>
						<execDefinition>
							<checksumGeneration>
								<sourceResource>
									<uri>${FILEWATCH-ANVILLON.lon-anvil-counterparty}</uri>
								</sourceResource>
								<markerResource>
									<uri>${SAG_DESTINATION_URI}/lon_anvil_counterparty_${SRC-FILE-SUFFIX-PATTERN-1}.mrk</uri>
								</markerResource>
								<checksumAlgorithm>SHA256</checksumAlgorithm>
							</checksumGeneration>
						</execDefinition>
					</stage>
					<stage name="GENERATE-MRK-LON-ANVIL-CPTY-CODE-KEY" id="GENERATE-MRK-LON-ANVIL-CPTY-CODE-KEY">
						<description>Validate checksum for file EGLLocation</description>
						<execDefinition>
							<checksumGeneration>
								<sourceResource>
									<uri>${FILEWATCH-ANVILLON.lon-anvil-cpty-code-key}</uri>
								</sourceResource>
								<markerResource>
									<uri>${SAG_DESTINATION_URI}/lon_anvil_cpty_code_key_${SRC-FILE-SUFFIX-PATTERN-1}.mrk</uri>
								</markerResource>
								<checksumAlgorithm>SHA256</checksumAlgorithm>
							</checksumGeneration>
						</execDefinition>
					</stage>
					<stage name="GENERATE-MRK-LON-ANVIL-EXPOSURE" id="GENERATE-MRK-LON-ANVIL-EXPOSURE">
						<description>Validate checksum for file EGLProduct</description>
						<execDefinition>
							<checksumGeneration>
								<sourceResource>
									<uri>${FILEWATCH-ANVILLON.lon-anvil-exposure}</uri>
								</sourceResource>
								<markerResource>
									<uri>${SAG_DESTINATION_URI}/lon_anvil_exposure_${SRC-FILE-SUFFIX-PATTERN-1}.mrk</uri>
								</markerResource>
								<checksumAlgorithm>SHA256</checksumAlgorithm>
							</checksumGeneration>
						</execDefinition>
					</stage>
					<stage name="GENERATE-MRK-LON-ANVIL-SECURITY-CODE-KEY" id="GENERATE-MRK-LON-ANVIL-SEC-CODE-KEY">
						<description>Validate checksum for file EGLBusinessUnit</description>
						<execDefinition>
							<checksumGeneration>
								<sourceResource>
									<uri>${FILEWATCH-ANVILLON.lon-anvil-security-code-key}</uri>
								</sourceResource>
								<markerResource>
									<uri>${SAG_DESTINATION_URI}/lon_anvil_security_code_key_${SRC-FILE-SUFFIX-PATTERN-1}.mrk</uri>
								</markerResource>
								<checksumAlgorithm>SHA256</checksumAlgorithm>
							</checksumGeneration>
						</execDefinition>
					</stage>
					<stage name="GENERATE-MRK-LON-ANVIL-INSTRUMENT" id="GENERATE-MRK-LON-ANVIL-INSTRUMENT">
						<description>Validate checksum for file EGLProduct</description>
						<execDefinition>
							<checksumGeneration>
								<sourceResource>
									<uri>${FILEWATCH-ANVILLON.lon-anvil-instrument}</uri>
								</sourceResource>
								<markerResource>
									<uri>${SAG_DESTINATION_URI}/lon_anvil_instrument_${SRC-FILE-SUFFIX-PATTERN-1}.mrk</uri>
								</markerResource>
								<checksumAlgorithm>SHA256</checksumAlgorithm>
							</checksumGeneration>
						</execDefinition>
					</stage>
					<stage name="GENERATE-MRK-LON-ANVIL-TRADE" id="GENERATE-MRK-LON-ANVIL-TRADE">
						<description>Validate checksum for file EGLBusinessUnit</description>
						<execDefinition>
							<checksumGeneration>
								<sourceResource>
									<uri>${FILEWATCH-ANVILLON.lon-anvil-trade}</uri>
								</sourceResource>
								<markerResource>
									<uri>${SAG_DESTINATION_URI}/lon_anvil_trade_${SRC-FILE-SUFFIX-PATTERN-1}.mrk</uri>
								</markerResource>
								<checksumAlgorithm>SHA256</checksumAlgorithm>
							</checksumGeneration>
						</execDefinition>
					</stage>
				</parallel>
				
				<parallel name="TRANSFER-ANVIL-EXTRACT-TO-SAG" id="TRANSFER-ANVIL-EXTRACT-TO-SAG">
					<skipCondition>'${SAG_DESTINATION_URI}' == 'NONE'</skipCondition>
					<stage name="TRANSFER-ANVIL-EXTRACT-TO-SAG-OUTBOX" id="TRANSFER-ANVIL-EXTRACT-TO-SAG-OUTBOX">
						<description>Transfer files from FTP directory to inbound processing directory</description>
						<execDefinition>
							<fileTransfer>
								<transfer>
									<sourceResource>
										<uri>${ANVILLON_REMOTE_SOURCE_URI}${#SRC-FILE-SUB-DIRECTORY}</uri>
										<searchPattern>lon_anvil_.*${INITIALIZE-RUN.BUSINESS-DATE-FORMATTED}.(csv.mrk|csv|mrk)</searchPattern>
										<matchedUriOutputProperty>matchedFiles</matchedUriOutputProperty>
									</sourceResource>
									<targetResource>
										<uri>${SAG_DESTINATION_URI}</uri>
									</targetResource>
								</transfer>
								<transferCountProperty>matchedCountTransfer</transferCountProperty>
							</fileTransfer>
						</execDefinition>
					</stage>
					
					<stage name="TRANSFER-ANVIL-EXTRACT-TO-SAG-OUTFILES" id="TRANSFER-ANVIL-EXTRACT-TO-SAG-OUTFILES">
						<description>Transfer files from FTP directory to inbound processing directory</description>
						<execDefinition>
							<fileTransfer>
								<transfer>
									<sourceResource>
										<uri>${SAG_DESTINATION_URI}</uri>
										<searchPattern>lon_anvil_.*${INITIALIZE-RUN.BUSINESS-DATE-FORMATTED}.(csv.mrk|csv|mrk)</searchPattern>
										<matchedUriOutputProperty>matchedFiles</matchedUriOutputProperty>
									</sourceResource>
									<targetResource>
										<uri>${CTR_DATA_ROOT_PATH}/data_out/outfiles/sag/SONIA</uri>
									</targetResource>
								</transfer>
								<transferCountProperty>matchedTransfer</transferCountProperty>
							</fileTransfer>
						</execDefinition>
					</stage>
					
					<stage name="TRANSFER-ANVIL-EXTRACT-TO-SAG-EDL" id="TRANSFER-ANVIL-EXTRACT-TO-SAG-EDL">
						<description>Transfer files from FTP directory to inbound processing directory</description>
						<execDefinition>
							<fileTransfer>
								<transfer>
									<sourceResource>
										<uri>${SAG_DESTINATION_URI}</uri>
										<searchPattern>lon_anvil_.*${INITIALIZE-RUN.BUSINESS-DATE-FORMATTED}.(csv.mrk|csv|mrk)</searchPattern>
										<matchedUriOutputProperty>matchedFiles</matchedUriOutputProperty>
									</sourceResource>
									<targetResource>
										<uri>${EDL_COPY_URI}/sag</uri>
									</targetResource>
								</transfer>
								<transferCountProperty>matchedTransfer</transferCountProperty>
							</fileTransfer>
						</execDefinition>
					</stage>
				</parallel>
				
			</sequential>
			<!--  -->
		</parallel>
		
		<stage name="RUN-COMPLETE" id="RUN-COMPLETE">
			<description>Finalize the run and mark complete</description>
			<execDefinition>
				<dbProcedure name="CTRMSO.RUN_COMPLETION_SP">
					<in>
						<param name="P_RUN_ID_I" type="NUMBER">${INITIALIZE-RUN.P_RUN_ID_O}</param>
						<param name="P_STAGE_ID_I" type="STRING">FINALIZE</param>
						<param name="P_TASK_ID_I" type="STRING">RUN-COMPLETE</param>
						<param name="P_LOG_ID_I" type="STRING">1</param>
						<param name="P_BUSSINESS_DATE_I" type="STRING">${INITIALIZE-RUN.BUSINESS-DATE}</param>
					</in>
					<out>
						<param name="P_RET_VALUE_O" type="NUMBER"></param>
						<param name="P_RET_MESSAGE_O" type="STRING"></param>
					</out>
				</dbProcedure>
			</execDefinition>
		</stage>
	</sequential>
</workflow>
	