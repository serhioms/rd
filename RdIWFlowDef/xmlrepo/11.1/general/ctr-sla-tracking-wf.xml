<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<!-- $Id: ctr-roll-business-date-wf.xml 4166 2016-06-23 19:13:32Z gmusial $
	 Maestro version: 1.19.3 -->
	
<workflow xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:noNamespaceSchemaLocation="workflowDefinition.xsd">
	<name>ctr-sla-tracking-wf</name> 
  	<externalWorkflowCode>ctr-sla-tracking-wf</externalWorkflowCode> 
  	<finishOrchestrationASAPOnError>false</finishOrchestrationASAPOnError> 
	<description>ctr-sla-tracking-wf ($LastChangedRevision: 4166 $)</description>
	
	<properties>
		<inputProperties>
			<!-- BUSINESS-DATE uses the date format: DD-MMM-YY OR the string value: 'DD-MMM-YY'
				A date in the format DD-MMM-YY will run the SLA process for the specified date
				The literal string 'DD-MMM-YY' - will run the SLA process for the current CTR business date
				-->
			<property name="BUSINESS-DATE">DD-MMM-YY</property>
			<property name="SOURCE-SYSTEM"/>
		</inputProperties>
		<generalProperties>			
			<property name="RUN-INSTANCE">1</property>
			<property name="ROOT-WF-ID">ctr-sla-tracking-wf</property>
			<property name="WORKFLOW_RUN_ID">0</property>
		</generalProperties>
	</properties>	

	<sequential name="CTR-ROLL-BPD" id="CTR-ROLL-BPD">
	
		<externalWorkflowReference name="INITIALIZE-RUN" id="INITIALIZE-RUN">
			<externalWorkflowCode>INITIALIZE-RUN</externalWorkflowCode>
			<inputProperties>
				<property name="EOD-EOM-INDICATOR">D</property>
				<property name="SOURCE-SYSTEM">-1</property>
				<property name="ROOT-WF-ID">${ROOT-WF-ID}</property>
				<property name="TARGET-SYSTEM"></property>
				<property name="RUN-TYPE" />
				<property name="RUN-INSTANCE">${RUN-INSTANCE}</property>
				<property name="WORKFLOW-RUN-ID">${WORKFLOW_RUN_ID}</property>
			</inputProperties>
			<outputPropertyMapping>
				<mapping source="BUSINESS-DATE" target="BUSINESS-DATE"/>
				<mapping source="BUSINESS-DATE-FORMATTED" target="BUSINESS-DATE-FORMATTED"/>
				<mapping source="RUN-ID" target="P_RUN_ID_O"/>
				<mapping source="IS-MONTH-END" target="IS-MONTH-END"/>
			</outputPropertyMapping>
		</externalWorkflowReference>
			
		<stage name="SLA-TRACKING-FOR-SPECIFIED-BUSINESS-DATE" id="SLA-TRACKING-FOR-SPECIFIED-BUSINESS-DATE">
			<description>Invokes the SLA Tracking procedure for the specified business date</description>
			<skipCondition>'${BUSINESS-DATE}' == 'DD-MMM-YY'</skipCondition>
			<execDefinition>
				<dbProcedure name="CTRMSO.RUN_SLA_TRACKING_SP">
					<in>
						<param name="P_BUSINESS_DATE_I" type="STRING">${BUSINESS-DATE}</param>
						<param name="P_RUN_ID_I" type="STRING">${INITIALIZE-RUN.P_RUN_ID_O}</param>
					</in>
					<out>
						<param name="P_RET_VALUE_O" type="NUMBER"></param>
						<param name="P_RET_MESSAGE_O" type="STRING"></param>
					</out>
				</dbProcedure>
			</execDefinition>
		</stage>
		
		<stage name="SLA-TRACKING-FOR-CTR-BUSINESS-DATE" id="SLA-TRACKING-FOR-CTR-BUSINESS-DATE">
			<description>Invokes the SLA Tracking procedure for the current CTR business date</description>
			<skipCondition>'${BUSINESS-DATE}' != 'DD-MMM-YY'</skipCondition>
			<execDefinition>
				<dbProcedure name="CTRMSO.RUN_SLA_TRACKING_SP">
					<in>
						<param name="P_BUSINESS_DATE_I" type="STRING">${INITIALIZE-RUN.BUSINESS-DATE}</param>
						<param name="P_RUN_ID_I" type="STRING">${INITIALIZE-RUN.P_RUN_ID_O}</param>
					</in>
					<out>
						<param name="P_RET_VALUE_O" type="NUMBER"></param>
						<param name="P_RET_MESSAGE_O" type="STRING"></param>
					</out>
				</dbProcedure>
			</execDefinition>
		</stage>
		
		<externalWorkflowReference name="FINALIZE-RUN" id="COMPLETE-RUN">
			<description>Finalize the run and mark complete</description>
			<externalWorkflowCode>FINALIZE-RUN</externalWorkflowCode>
			<inputProperties>
				<property name="SOURCE-SYSTEM">NONE</property>
				<property name="RUN-ID">${INITIALIZE-RUN.P_RUN_ID_O}</property>
				<property name="BUSINESS-DATE">${INITIALIZE-RUN.BUSINESS-DATE}</property>
				<property name="SRC-FILE-SUFFIX-PATTERN">NONE</property>
				<property name="FTP-SOURCE-DIR">NONE</property>
			</inputProperties>
		</externalWorkflowReference>
	</sequential>
</workflow>